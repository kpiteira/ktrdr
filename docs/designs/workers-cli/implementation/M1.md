---
design: docs/designs/workers-cli/DESIGN.md
---

# M1: Workers CLI Command

Implement `ktrdr workers` command to display worker status.

## Task 1.1: Implement workers command (CODING)

Create the workers CLI command following existing patterns.

### Files to Create
- `ktrdr/cli/commands/workers.py` - Command implementation

### Files to Modify
- `ktrdr/cli/app.py` - Register the command

### Implementation Notes

Follow the pattern from `status.py`:
- `@trace_cli_command("workers")` decorator
- Lazy imports inside function body
- `AsyncCLIClient` for API call to `/workers`
- Handle `state.json_mode` for JSON output
- Rich table for default output

Table columns:
- TYPE (worker_type)
- STATUS (status)
- GPU (capabilities.gpu_type or "-")
- ENDPOINT (endpoint_url, shortened)
- OPERATION (current_operation_id or "-")

### Acceptance Criteria
- [ ] `ktrdr workers` displays worker table
- [ ] `ktrdr --json workers` outputs JSON array
- [ ] Respects `--url` and `--port` flags
- [ ] GPU workers clearly identified

---

## Task 1.2: Add unit tests (CODING)

### Files to Create
- `tests/unit/cli/commands/test_workers.py`

### Test Cases
1. `test_workers_displays_table` - Mocked API response renders correctly
2. `test_workers_json_output` - JSON mode outputs raw API data
3. `test_workers_empty` - Handles no workers gracefully
4. `test_workers_with_gpu` - GPU capability displayed correctly

### Acceptance Criteria
- [ ] All test cases pass
- [ ] Uses `runner` fixture (not raw CliRunner)
- [ ] Mocks API calls properly

---

## Task 1.3: E2E Validation (VALIDATION)

Validate the command works against running system.

### Test Steps
1. Ensure Docker containers are running
2. Run `ktrdr workers` - verify table output
3. Run `ktrdr --json workers` - verify JSON output
4. Compare output with `curl /api/v1/workers` - data should match

### Success Criteria
- [ ] Command executes without error
- [ ] Output shows actual workers from the system
- [ ] JSON output is valid and matches API response
