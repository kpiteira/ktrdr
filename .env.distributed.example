# KTRDR Distributed Architecture - Environment Variables
# Copy this file to .env and modify as needed
#
# Pure Distributed Architecture (Phases 5-6)
# Backend always uses WorkerRegistry for backtesting and training (no local execution)
# Workers register themselves on startup (push-based registration)

# ============================================================================
# IB Data Access (Host Service Required)
# ============================================================================
# IB Gateway requires host service for direct TCP connection (Docker networking limitation)
USE_IB_HOST_SERVICE=true
IB_HOST_SERVICE_URL=http://host.docker.internal:5001

# IB Gateway Connection Settings
IB_HOST=172.17.0.1  # Bridge gateway IP
IB_PORT=4002        # TWS/Gateway port (4002 for paper, 4001 for live)
IB_CLIENT_ID=1      # Client ID for connection

# ============================================================================
# Worker Configuration
# ============================================================================
# Workers register themselves with backend on startup - no environment variables
# needed in backend for worker discovery!
#
# Workers use WorkerRegistry (distributed-only mode):
# - Backtesting: Uses any available backtest worker (CPU-only)
# - Training: GPU-first, CPU-fallback automatic selection
#
# To add workers:
# 1. Docker Compose: docker-compose up --scale backtest-worker=N
# 2. Proxmox LXC: Clone template, assign IP, start service
# 3. Manual: Start worker process, it will self-register

# ============================================================================
# Backend Configuration
# ============================================================================
# Backend API URL (for workers to register)
KTRDR_API_URL=http://backend:8000

# Backend operations cache (for progress tracking)
OPERATIONS_CACHE_TTL=1  # seconds (1s default)

# Worker health check configuration
WORKER_HEALTH_CHECK_INTERVAL=10      # seconds between health checks
WORKER_HEALTH_CHECK_TIMEOUT=5        # seconds per health check
WORKER_HEALTH_CHECK_FAILURES=3       # failures before marking unavailable
WORKER_REMOVAL_THRESHOLD=300         # seconds (5 minutes) before removing dead workers

# ============================================================================
# Development vs Production
# ============================================================================
ENVIRONMENT=development  # development | production

# Development: Docker Compose
# - Workers: Docker containers that self-register
# - Backend URL: http://backend:8000 (Docker DNS)
# - Worker URLs: Auto-detected via hostname

# Production: Proxmox LXC
# - Workers: LXC containers that self-register
# - Backend URL: http://192.168.1.100:8000 (static IP)
# - Worker URLs: Auto-detected via IP discovery
