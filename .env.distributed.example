# KTRDR Distributed Architecture - Environment Variables
# ======================================================
# Copy this file to .env and modify as needed
#
# Pure Distributed Architecture (Phases 5-6)
# Backend always uses WorkerRegistry for backtesting and training (no local execution)
# Workers register themselves on startup (push-based registration)
#
# All KTRDR-specific variables use the KTRDR_* prefix.

# ============================================================================
# IB Data Access (Host Service Required)
# ============================================================================
# IB Gateway requires host service for direct TCP connection (Docker networking limitation)
KTRDR_IB_HOST_ENABLED=true
KTRDR_IB_HOST_HOST=host.docker.internal
KTRDR_IB_HOST_PORT=5001

# IB Gateway Connection Settings (used by host service)
KTRDR_IB_HOST=172.17.0.1  # Bridge gateway IP
KTRDR_IB_PORT=4002        # TWS/Gateway port (4002 for paper, 4001 for live)
KTRDR_IB_CLIENT_ID=1      # Client ID for connection

# ============================================================================
# Worker Configuration
# ============================================================================
# Workers register themselves with backend on startup - no environment variables
# needed in backend for worker discovery!
#
# Workers use WorkerRegistry (distributed-only mode):
# - Backtesting: Uses any available backtest worker (CPU-only)
# - Training: GPU-first, CPU-fallback automatic selection
#
# To add workers:
# 1. Docker Compose: docker-compose up --scale backtest-worker=N
# 2. Proxmox LXC: Clone template, assign IP, start service
# 3. Manual: Start worker process, it will self-register

# ============================================================================
# Backend Configuration
# ============================================================================
# Backend API URL (for workers and agents to connect)
KTRDR_API_CLIENT_BASE_URL=http://backend:8000/api/v1

# Backend operations cache (for progress tracking)
KTRDR_OPS_CACHE_TTL=1  # seconds (1s default)

# Worker health check configuration
KTRDR_WORKER_HEALTH_CHECK_INTERVAL=10      # seconds between health checks
KTRDR_WORKER_HEALTH_CHECK_TIMEOUT=5        # seconds per health check
KTRDR_WORKER_HEALTH_CHECK_FAILURES=3       # failures before marking unavailable
KTRDR_WORKER_REMOVAL_THRESHOLD=300         # seconds (5 minutes) before removing dead workers

# ============================================================================
# Environment Mode
# ============================================================================
KTRDR_API_ENVIRONMENT=development  # development | staging | production

# Development: Docker Compose
# - Workers: Docker containers that self-register
# - Backend URL: http://backend:8000 (Docker DNS)
# - Worker URLs: Auto-detected via hostname

# Production: Proxmox LXC
# - Workers: LXC containers that self-register
# - Backend URL: http://192.168.1.100:8000 (static IP)
# - Worker URLs: Auto-detected via IP discovery
